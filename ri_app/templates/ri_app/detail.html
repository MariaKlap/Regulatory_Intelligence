<!-- ri_app/templates/ri_app/detail.html -->
{% extends "ri_app/base.html" %}

{% block content %}
<div class="card">
    <!-- Modified card-header with eye icon -->
    <div class="card-header d-flex justify-content-between align-items-center">
        <h2>{{ item.title }}</h2>
        <i id="viewed-icon" 
           class="bi bi-eye{% if item.viewed %}-fill text-danger{% endif %}" 
           style="font-size: 1.5rem; cursor: pointer;"
           data-item-id="{{ item.id }}"
           data-viewed="{% if item.viewed %}true{% else %}false{% endif %}"
           title="{% if item.viewed %}Mark as unread{% else %}Mark as read{% endif %}"></i>
    </div>
    
    <div class="card-body">
        <p><strong>Date:</strong> {{ item.date }}</p>
        <p><strong>Agency:</strong> {{ item.agency }}</p>
        <p><strong>Category:</strong> {{ item.category }}</p>
        <p><strong>Source:</strong> {{ item.source_file }}</p>
        
        <div class="mt-4">
            <h4>Summary</h4>
            <p>{{ item.summary|linebreaks }}</p>
        </div>
        
        <a href="{{ item.article_url }}" target="_blank" class="btn btn-primary mt-3">View Original Article</a>
    </div>
</div>

<a href="{% url 'dashboard' %}" class="btn btn-secondary mt-3">Back to Dashboard</a>

<!-- Add Bootstrap Icons CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">

<script>
document.addEventListener('DOMContentLoaded', function() {
    const icon = document.getElementById('viewed-icon');
    
    icon.addEventListener('click', function() {
        const itemId = this.getAttribute('data-item-id');
        const isViewed = this.getAttribute('data-viewed') === 'true';
        const newViewedState = !isViewed;
        
        // Send AJAX request to update viewed status
        fetch(`/update_viewed/${itemId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({
                viewed: newViewedState
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update icon appearance
                this.setAttribute('data-viewed', newViewedState.toString());
                if (newViewedState) {
                    this.classList.remove('bi-eye');
                    this.classList.add('bi-eye-fill', 'text-danger');
                    this.title = "Mark as unread";
                } else {
                    this.classList.remove('bi-eye-fill', 'text-danger');
                    this.classList.add('bi-eye');
                    this.title = "Mark as read";
                }
            }
        });
    });
});
</script>
{% endblock %}